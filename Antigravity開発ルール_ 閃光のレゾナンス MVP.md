# Antigravity開発ルール: 閃光のレゾナンス MVP

このドキュメントは、Antigravityが「閃光のレゾナンス」のMVP（最小機能製品）を開発する際に遵守すべき技術的制約とコアロジックを定義します。

## 1. MVP開発の目標

| 項目 | 目標 |
| :--- | :--- |
| **コア機能** | 「進む」ボタンによる探索と、高速オートバトル、リアルタイム閃きの実装。 |
| **環境構築** | Docker Composeによる開発環境の完全構築（フロントエンド、DB）。 |
| **UI/UX** | 縦画面レイアウトでの「ポチポチ」操作の快適性を最優先。 |

## 2. 技術スタックの制約

| レイヤー | 技術 | 制約事項 |
| :--- | :--- | :--- |
| **フロントエンド** | React + Vite | 高速な描画とビルドを維持すること。 |
| **ゲームエンジン** | PixiJS | バトルエリアの描画に専念し、派手なエフェクト（閃光、パーティクル）を実装すること。 |
| **データベース** | TiDB (MySQL互換) | キャラクターデータ、技データ、ルーンデータの管理に用いること。 |
| **開発環境** | Docker Compose | `docker compose up` 一発で全ての環境が起動するように構成すること。 |

## 3. コアロジックの定義

### 3.1. 高速オートバトル
- **進行**: プレイヤーが「進む」ボタンをタップすると、敵と遭遇しバトル開始。
- **速度**: 1バトルは**数秒**で決着すること。アニメーション速度は高速化設定をデフォルトとすること。
- **終了**: 敵の全滅で勝利。パーティの全滅で敗北（ゲームオーバーなし、経験値は保持）。

### 3.2. リアルタイム閃き
- **発生条件**: キャラクターの攻撃時に一定確率（例: 5%）で発生。
- **演出**:
    1. 攻撃ヒット直前に**0.2秒のヒットストップ**を実装。
    2. キャラクターの目元アップの**カットイン**を挿入。
    3. 画面全体に**ネオンカラーの閃光エフェクト**を重ねる。
    4. 新しい技を習得し、戦闘ログに表示する。
- **ロジック**: 閃きは、そのキャラクターが使用した技の系統と敵の強さに依存する（MVPでは確率のみ実装可）。

### 3.3. 技の連携（チェイン・レゾナンス）：大連携システム
- **ロジック**: 連続する攻撃の属性が一致、または特定の組み合わせで連携が発生。**控えメンバー（最大10名）も自動追撃**で参加すること。
- **MVPでの実装**: 
    - 連携数に応じてダメージが指数関数的に増加（1.2^連携数 倍など）。
    - 5連携以上で「連携専用技」を閃く確率を設けること。
    - 連携中はBGMのピッチを上げ、画面の揺れ（シェイク）を連携数に応じて強くすること。

### 3.4. 無限の技派生ロジック
- **ロジック**: 技の使用回数や敵のランク、連携状況に応じて、新しい技への派生（閃き）が発生するツリー構造を実装すること。
- **MVPでの実装**: 
    - 技Aから技B、技Bから技Cといった直線的な派生だけでなく、特定の技の組み合わせから派生する「複合閃き」のフラグを管理すること。
    - 技データは動的に拡張可能な構造（JSON等）で管理し、無限の追加に対応させること。

## 4. UI/UXの制約
- **画面構成**: 縦画面レイアウトを必須とする。
- **操作**: 画面下部に「進む」ボタンを大きく配置し、片手操作を可能にすること。
- **爽快感**: ダメージ数字はインフレさせ、視覚的な快感を最大化すること。
- **フォント**: プロジェクト設計書で定義されたフォント（例: Space Grotesk, Noto Sans JP）を使用すること。

## 5. リソース生成と動的演出の制約
- **ベースリソース**: キャラクター、エフェクト、SEのベース素材はAI生成スクリプト（OpenAI API等）を用いて調達すること。
- **動的バリエーション**: 
    - **画像**: PixiJSのフィルタ（ColorMatrixFilter等）を用い、1つのベース画像から属性に応じた色相変化をリアルタイムで行うこと。
    - **音声**: Web Audio APIを用い、SEのピッチや再生速度を状況に応じて動的に変更すること。
- **無限の組み合わせ**: 技名やエフェクトの組み合わせをプログラム上でランダムまたはロジックに基づいて生成し、アセットの重複感を感じさせない工夫をすること。
